<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S79Y2FRX1H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S79Y2FRX1H');
  </script>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Blogs | Bharat Darshan</title>

  <link rel="icon" href="images/tablogo.png">

  <!-- CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/blog.css">

  <style>
    .postcard__text { padding: 0 40px; }
  </style>
</head>

<body>

<div id="top"></div>

<!-- ================= HEADER ================= -->
<header class="header">
  <a href="index.html" class="logo">
    <img src="images/tablogo.png" alt="Logo" style="height:80px;">
    Bharat Darshan
  </a>

  <nav class="navbar">
    <div id="nav-close" class="fas fa-times"></div>
    <a href="index.html">home</a>
    <a href="adventure.html">adventure</a>
    <a href="map.html">map</a>
    <a href="blogs.html">blogs</a>
    <a href="events.html">events</a>
    <a href="products.html">products</a>
    <a href="about.html">about us</a>
  </nav>

  <div class="icons">
    <div id="menu-btn" class="fas fa-bars"></div>
    <div id="search-btn" class="fas fa-search"></div>
  </div>
</header>

<!-- ================= SEARCH ================= -->
<div class="search-form">
  <div id="close-search" class="fas fa-times"></div>
  <form>
    <input type="search" placeholder="search here..." id="search-box">
    <label for="search-box" class="fas fa-search"></label>
  </form>
</div>

<div class="banner-area"></div>

<!-- ================= BLOG SECTION ================= -->
<section class="light">
  <div class="container py-2">

    <div class="h1 text-center text-dark pb-4" id="pageHeaderTitle">
      Welcome To Our Blog
    </div>

    <div class="text-center mb-4">
      <button class="btn btn-danger px-4" id="addBlogBtn">
        <i class="fas fa-plus mr-2"></i> Add Your Blog
      </button>
    </div>

    <!-- ===== BLOG MODAL ===== -->
    <div class="modal fade" id="blogModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title">Add Your Blog</h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>

          <div class="modal-body">
            <form id="blogForm">
              <div class="form-group">
                <label>Blog Title</label>
                <input type="text" class="form-control" id="blogTitle" required>
              </div>

              <div class="form-group">
                <label>Blog Description</label>
                <textarea class="form-control" id="blogDescription" rows="4" required></textarea>
              </div>

              <button type="submit" class="btn btn-success">
                Submit Blog
              </button>
            </form>
          </div>

        </div>
      </div>
    </div>

    <!-- ===== BLOG CONTAINER ===== -->
    <div id="blogContainer"></div>

  </div>
</section>

<!-- ================= TO TOP ================= -->
<a href="#top" class="to-top">
  <i class="fas fa-chevron-up"></i>
</a>

<!-- ================= SCRIPTS ================= -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/allscript.js"></script>

<!-- ================= BACKEND INTEGRATION ================= -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  const API_URL = "http://localhost:3000/blogs";

  document.getElementById("addBlogBtn").addEventListener("click", function () {
    $('#blogModal').modal('show');
  });

  function loadBlogs() {
    fetch(API_URL)
      .then(res => res.json())
      .then(blogs => {
        const container = document.getElementById("blogContainer");
        container.innerHTML = "";

        if (blogs.length === 0) {
          container.innerHTML = "<p class='text-center'>No blogs yet. Be the first to add one!</p>";
          return;
        }

        blogs.forEach(blog => {
          const blogHTML = `
            <article class="postcard light blue">
              <a class="postcard__img_link" href="#">
                <img class="postcard__img"
                     src="${blog.image || 'images/default-blog.jpg'}"
                     alt="${blog.title}">
              </a>

              <div class="postcard__text t-dark">
                <h1 class="postcard__title blue">
                  <a href="#">${blog.title}</a>
                </h1>

                <div class="postcard__subtitle small">
                  <i class="fas fa-calendar-alt mr-2"></i>
                  ${new Date(blog.created_at).toLocaleString()}
                </div>

                <div class="postcard__bar"></div>

                <div class="postcard__preview-txt">
                  ${blog.description}
                </div>
              </div>
            </article>
          `;
          container.insertAdjacentHTML("beforeend", blogHTML);
        });
      })
      .catch(err => console.error("Error loading blogs:", err));
  }

  document.getElementById("blogForm").addEventListener("submit", function (e) {
    e.preventDefault();

    fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        title: blogTitle.value,
        description: blogDescription.value,
        image: "images/default-blog.jpg"
      })
    }).then(() => {
      $('#blogModal').modal('hide');
      blogForm.reset();
      loadBlogs();
    });
  });

  loadBlogs();
});
</script>

</body>
</html>
